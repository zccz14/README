---
"title": "Análisis de Espectro Completo: El Método Óptimo para Monetizar la Información"
"summary": "Este artículo propone el Análisis de Espectro Completo (FSA), un marco de estrategia de inversión y trading optimizado basado en el Criterio de Kelly. Primero, analiza las limitaciones de la fórmula tradicional de Kelly en aplicaciones de inversión, como la falta de consideración de apalancamiento y ventas en corto, problemas de timing de liquidación, etc. Luego, el FSA construye un modelo sistemático de toma de decisiones de trading definiendo el espacio de resultados, calculando el apalancamiento óptimo y la tasa de rendimiento compuesta. El artículo detalla los principios matemáticos del FSA, incluyendo el cálculo del rendimiento esperado y compuesto, así como el algoritmo para resolver el apalancamiento óptimo usando el método de Newton. Además, introduce métodos de backtesting histórico (como el cálculo del Margen Bruto de Beneficio, GPM), consideraciones para el módulo de trading en tiempo real, y medidas para eventos de cisne negro. La ventaja central del FSA radica en su capacidad para utilizar información probabilística imperfecta, optimizando la decisión de apalancamiento para maximizar el rendimiento a largo plazo, reduciendo así los altos requisitos de calidad de la información."
"tags":
  - "Análisis de Espectro Completo"
  - "Fórmula de Kelly"
  - "Estrategia de Inversión"
  - "Optimización de Apalancamiento"
  - "Tasa de Rendimiento Compuesta"
  - "Gestión de Riesgos"
  - "Trading Algorítmico"
  - "Eventos de Cisne Negro"
"date": "2025-08-10"
---

# Análisis de Espectro Completo: El Método Óptimo para Monetizar la Información

2025-08-10

## Antecedentes

**¿Cómo maximizar la tasa de crecimiento de los activos?**

En 1956, J.L. Kelly publicó "A New Interpretation of Information Rate" (Una Nueva Interpretación de la Tasa de Información). El artículo discute cómo un apostador puede utilizar información conocida para maximizar la tasa de crecimiento compuesta de sus activos. Propone un método probabilístico para guiar la estrategia de apuestas. Sin embargo, aplicar este artículo a actividades de inversión reales presenta varios problemas:

1.  No utiliza apalancamiento mediante préstamo ni ventas en corto, por lo que sus conclusiones se mantienen dentro del rango de apalancamiento real de 0~1.
2.  Asume que el apostador apuesta por un símbolo de evento, recibiendo un pago si ocurre la próxima vez, o perdiendo su apuesta en caso contrario. Pero los traders solo pueden apostar a largo/corto, y los eventos alcistas/bajistas correspondientes presentan diferentes resultados y diferentes tasas de rendimiento en diferentes ventanas de tiempo.
3.  Timing de liquidación: Kelly asume que el final y la liquidación de la apuesta no están determinados por la voluntad del apostador. Pero los traders pueden decidir salir o mantener la posición en cualquier momento.
4.  Método bayesiano redundante, asume que el desarrollo de los eventos está relacionado con probabilidades previas y condicionales anteriores. Eliminar el método bayesiano no afecta la esencia matemática derivada. Aumenta la dificultad, usar directamente la fórmula del artículo es complejo, y su uso práctico requiere simplificación.

Continuaremos utilizando el método probabilístico del artículo de Kelly para explorar una estrategia práctica aplicable al campo del trading de inversión.

## Análisis de Espectro Completo: Full-Spectrum Analysis, FSA

### Espacio de Resultados, Apalancamiento Óptimo y Rendimiento Óptimo

Supongamos que al implementar una estrategia de trading, finalmente habrá varios eventos de resultado diferentes. Sea el espacio de resultados $X$. $X$ no está vacío (en escenarios reales, existen al menos 2 resultados).

Hagamos algunas suposiciones adicionales:

1.  Rendimiento Determinista: Cada evento de resultado corresponde a una tasa de rendimiento definida. Sea $R_i$ la tasa de rendimiento del resultado $i$.
    1.  ✅ Eventos con diferentes tasas de rendimiento deben considerarse eventos de resultado diferentes, por ejemplo, una ganancia del 1% y una ganancia del 2% son diferentes.
    1.  ❌ Agrupar eventos de ganancia con rendimientos claramente diferentes en el mismo resultado viola el rendimiento determinista.
1.  Probabilidad Determinista: Sea $P_i$ la probabilidad de que ocurra el resultado $i \in X$, ($0 \le P_i \le 1$).
    1.  ✅ La probabilidad de cada resultado debe evaluarse de manera determinista.
    1.  ❌ Considerar que la posibilidad de que ocurra un resultado es superior al 80%: 80%～ 100%, viola la probabilidad determinista.
1.  Exclusividad Mutua: No es posible que ocurran 2 resultados simultáneamente.
    1.  ✅ Se deben diseñar eventos de resultado que sean completamente imposibles de ocurrir al mismo tiempo.
    1.  ❌ Si los eventos de resultado tienen intersección, por ejemplo, los eventos "mantener posición 20 minutos" y "caída del 20%" pueden ocurrir simultáneamente, violando la exclusividad mutua.
1.  Exhaustividad: La suma de las probabilidades de todos los resultados es del 100%, no existen resultados fuera de los resultados predefinidos, es decir, $\sum_{i \in X} P_i = 1$.
    1.  ✅ Se deben considerar todos los resultados posibles.
    1.  ❌ Si los eventos de resultado solo definen "subida >20%", "bajada >20%", y no definen "movimiento entre -20% y 20%", se viola la exhaustividad.
1.  Efecto de Apalancamiento: La tasa de rendimiento sigue el efecto de apalancamiento, es decir, si se usa un apalancamiento de $k$ veces, cuando ocurre el resultado $i$, la tasa de rendimiento es $k \cdot R_i$, lo que significa que el activo se convierte en $1 + k \cdot R_i$ veces el original.
1.  ✅ Los productos de inversión con suficiente liquidez cumplen esta característica.
1.  ❌ Cuando el tamaño de la posición es demasiado alto, debido a problemas de liquidez, se generan costes de impacto de mercado y el rendimiento ya no sigue una relación lineal.

Para el espacio de resultados $X$, se puede calcular su **Rendimiento Esperado Expected Earning Yield**:
$$E(X) = \sum_{i \in X} P_i R_i$$

El concepto de rendimiento esperado es bastante intuitivo y fácil de calcular. El problema del rendimiento esperado es:

1.  Deriva decisiones extremas, o bien posición cero o bien posición máxima, sin poder controlar el riesgo de quiebra. Si el rendimiento esperado es positivo, tenderá a amplificar el apalancamiento infinitamente para buscar un mayor rendimiento, incluso si un alto apalancamiento puede llevar a la quiebra.
2.  No considera el efecto del interés compuesto. Solo considera el rendimiento de una inversión única, no considera que el mercado permite inversiones repetidas. No se ajusta a la situación real de la gestión de inversiones.

**Rendimiento Compuesto Compound Earning Yield**, se refiere a la tasa de rendimiento promedio por operación después de realizar múltiples operaciones independientes de forma repetida:

$$C(X, k) = (\prod_{i \in X} (1 + k \cdot R_i)^{P_i}) - 1$$

**Rendimiento Óptimo Optimal Earning Yield**, es el valor máximo del rendimiento compuesto bajo diferentes niveles de apalancamiento:

$$O(X) = \max_k C(X, k)$$

Para no quebrar y llegar a cero, se debe cumplir que para todos los resultados, $1 + k \cdot R_i >0$, lo que permite derivar un dominio factible básico para k, $K$:

Límite superior:

$$\max k = \max(0, \min_{R_i < 0} {-\frac{1}{R_i}})$$

Límite inferior:

$$\min k = \min(0, \max_{R_i > 0} {-\frac{1}{R_i}})$$

Y una solución siempre factible $k = 0$,

$$K = (\min k, \max k) \cup \{ 0 \}$$

El apalancamiento óptimo es el $k$ dentro del dominio factible $K$ que maximiza el rendimiento compuesto $C(X, k)$.

$$k_o = \argmax_k C(X, k)$$

En cualquier momento, se puede calcular el apalancamiento real en la cuenta: $k = \frac{tamaño\ de\ la\ posición}{valor\ neto\ de\ la\ cuenta}$, y también evaluar el apalancamiento óptimo: $k_o$.
Todas las estrategias de trading finalmente corresponden a un apalancamiento real. Tomar una decisión de trading determinista equivale a decidir el valor de $k$. Y el apalancamiento óptimo corresponde a la posición ideal.

Así obtenemos un marco de trading:

1.  Diseñar el espacio de resultados $X$.
2.  Evaluar continuamente las probabilidades $P$ de los diferentes resultados.
3.  Calcular el apalancamiento real $k$ y el apalancamiento óptimo $k_O$.
4.  Controlar que el apalancamiento real se acerque al apalancamiento óptimo.

> **Punto Especial**
>
> Punto trivial $C(X, 0) = 0$, es decir, "sin participación no hay ganancias ni pérdidas".
> Cuando no tenemos posición, es equivalente a decidir $k = 0$. Para cualquier producto, con o sin posición, en cada momento estamos tomando una decisión.
> Venta en corto corresponde al caso $k < 0$; si $|k| > 1$, significa que se necesita apalancamiento adicional.

### Resolución de la Optimización

Repasando el problema, conocido el espacio de resultados $X$, la distribución de probabilidad $P_i$, el rendimiento $E_i$, el dominio factible $[L, R]$, encontrar la tasa de apalancamiento $k \in [L, R]$ que maximice el rendimiento:

Reorganizando el rendimiento compuesto y tomando logaritmos en ambos lados (manteniendo la monotonicidad), obtenemos:

$$\ln (1 + C(X, k)) = \sum_{i \in X} P_i \ln (1 + k \cdot R_i)$$

Sea

$$G(k) = \ln(1 + C(X, k)) = \sum_{i \in X} P_i \ln (1 + k R_i)$$

Según la definición de apalancamiento óptimo:

$$k_o = \argmax_k C(X, k)$$

Dado que $f(x) = \ln(1+x)$ es monótonamente creciente:

$$k_o = \argmax_k C(X, k) = \argmax_k G(k)$$

Calculando la primera y segunda derivada de $G(k)$:

$$G'(k) = \sum_{i \in X} \frac{P_i R_i}{1 + k R_i} $$

$$G''(k) = \sum\_{i \in X} -\frac{P_i R_i^2}{(1 + k R_i)^2} $$

En la segunda derivada, cada término es no positivo, por lo tanto $G''(k) \le 0$. Si y solo si $P_i R_i \equiv 0$, entonces $G''(k) = 0$, y en ese caso, $G(k) \equiv 0$, no hay ningún rendimiento, carece de significado práctico. En otros casos, $G''(k) < 0$. Esto significa que $G(k)$ es una función estrictamente cóncava, $G'(k)$ es estrictamente monótona decreciente. $G(k)$ tiene un único punto máximo, y este punto máximo es el punto de valor máximo.

Como se muestra en la siguiente figura, sin importar cuántos términos tenga $G(k)$, su curva es una función cóncava.

![Ilustración de la curva de la Fórmula de Kelly](czon://2422dc9f38d7d5aec3288d100b4334dfdbc7adfd4eba88814511a78ad3a0a4ce)

El punto máximo de $G(k)$ es el cero de su primera derivada:

$$G'(k) = \sum_{i \in X} \frac{P_i R_i}{1 + k R_i} = 0$$

Si reorganizamos esta ecuación, se puede transformar en una ecuación polinómica en k.
Si existen $N$ valores diferentes para $R_i$, entonces el grado máximo del polinomio anterior es $N-1$.
Según el teorema de Abel-Ruffini, los polinomios de grado cinco o superior no tienen una fórmula general para encontrar raíces.

La fórmula de Kelly común es un caso especial con $N=2$: Sea la probabilidad de ganar $p$, la cuota $b$.

| Resultado | Probabilidad | Rendimiento |
| --------- | ------------ | ----------- |
| Ganar     | $p$          | $b$         |
| Perder    | $1-p$        | $-1$        |

Sustituyendo obtenemos la ecuación:

$$G'(k) = \frac{pb}{1+kb} + \frac{-(1-p)}{1 -k} = 0$$

Reorganizando se obtiene

$$k = \frac{p(b+1)-1}{b}$$

Que es la demostración de la Fórmula de Kelly.

Para escenarios de trading, pueden aparecer infinitos resultados con diferentes tasas de rendimiento, por lo tanto, solo se pueden buscar soluciones numéricas.

Como función estrictamente cóncava de una variable, usar el método de Newton para resolver es la opción ideal.
Comenzar la iteración desde el punto fijo $$G(0) = 0$$ es una buena opción, una función estrictamente cóncava convergerá al mismo resultado desde cualquier punto de inicio.

#### Situación donde el Método de Newton excede el Dominio Factible

Un problema potencial es que el punto de iteración obtenido por el método de Newton puede exceder el dominio factible del problema.
Usemos un ejemplo mínimo para ilustrar esta situación:

$$p_1 = 0.9, r_1 = 0.5, p_2 = 0.1, r_2 = -1$$

Obtenemos

$$G(k) = 0.9 \times \ln(1+0.5k) + 0.1 \times \ln(1 - k)$$

![Imagen de la función G(k)](czon://4068dbc6a1d3a0c0f375de7413f335115d4124fa2a01a5646010c56d8ec767ad)

Cálculo muestra que el dominio factible $K = (-2, 1)$, el apalancamiento óptimo analítico es $k_o = 0.7$,
pero al usar el método de Newton, el primer punto de iteración

$$G(0) - \frac{G'(0)}{G''(0)} = \frac{14}{13} > 1$$

![Demostración de G'(k) y el método de Newton](czon://e5c9fbcc6e652381ce552a033b04583b026e01af0369b5b3bba1e18f4d50fbd3)

El primer punto de iteración ya excede el dominio factible, excede el dominio de definición de la derivada, y continuar iterando carece de sentido. Esto muestra que el método de Newton simple por sí mismo no puede manejar situaciones donde se excede el dominio factible.

La solución es, después de calcular el punto de iteración usando el método de Newton, verificar adicionalmente si está dentro del dominio factible. Si lo está, iterar hasta allí; si no lo está, según su dirección, tomar un punto entre el límite del dominio factible y el punto actual como el siguiente punto de iteración.

#### Pseudocódigo del Algoritmo

Algoritmo $\text{resolve}(G, L, R, \epsilon = 10^{-9}, N = 100, \alpha = 0.9)$

1.  Inicializar $k \gets 0$
2.  Según la tasa de rendimiento $r_i$, calcular el dominio factible básico $K$
3.  Recortar el dominio factible $L \gets \max(L, \min K), R \gets \min(R, \max K)$
4.  Bucle máximo $N$ veces:
    1.  Calcular el siguiente punto $k' \gets k - \frac{G'(k)}{G''(k)}$
    2.  Si $k'$ no pertenece a $K$
        1.  Si $k' \ge R$, tomar $k' \gets \alpha R + (1-\alpha)k$
        2.  Si $k' \le L$, tomar $k' \gets \alpha L + (1 - \alpha) k$
    3.  Si la diferencia es menor que el umbral de precisión $| k' - k | < \epsilon$, salir del bucle.
    4.  Actualizar $k \gets k'$
5.  Devolver $k$

#### Implementación del Código

Desde una perspectiva de programación, una abstracción más adecuada es: supongamos que cada resultado en el conjunto de resultados tiene dos atributos, tasa de rendimiento r, peso w. Este espacio de resultados puede ser recorrido, entonces el algoritmo puede escribirse como:

```ts
/**
 * Según el Criterio de Kelly, calcula el ap