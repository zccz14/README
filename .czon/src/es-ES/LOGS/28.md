---
"title": "Reestructuración del Directorio y Optimización de Traducción de CZON"
"summary": "Este artículo detalla la importante reestructuración de la herramienta de generación de documentos CZON en la versión 0.6.0. El autor señala primero que el uso de Hash como ID de archivo fuente en versiones anteriores causaba una avalancha de tareas de traducción al modificar un artículo, así como el desafío del alto consumo de tokens en la traducción generativa adversaria. Para abordar esto, CZON reestructuró el directorio de generación, cambiando a copiar los archivos fuente tal cual según su ruta, evitando así la regeneración en cadena. Además, el autor discute métodos para optimizar el consumo de tokens en la traducción generativa adversaria, como el uso de directorios temporales para limitar el acceso a archivos. El artículo también presenta direcciones de optimización adicionales, como la referencia a recursos estáticos, la separación de tareas de traducción de Metadata y la eliminación automática de archivos residuales, enfatizando que en el futuro se reactivará la traducción generativa adversaria para manejar artículos largos."
"tags":
  - "CZON"
  - "Estructura de Directorios"
  - "Optimización de Traducción"
  - "Consumo de Tokens"
  - "Generación de Documentos"
  - "Recursos Estáticos"
  - "Metadata"
  - "Generación Adversaria"
"date": "2026-01-26"
---

Ahora es el 26 de enero de 2026, lunes, 4:00 a.m.

### Reestructuración del Directorio de CZON

El efecto de la [traducción generativa adversaria mencionada anteriormente](./27.md) es realmente bueno. Sin embargo, se descubrió un problema en CZON: utiliza Hash como ID de los archivos fuente, lo que provocó que, al modificar un artículo referenciado 9 veces, se desencadenara una avalancha de (1 + 9) \* 3 = 30 tareas de traducción. Además, el consumo de tokens de la traducción generativa adversaria es aproximadamente 10 veces mayor que el de la traducción normal. En artículos largos que pasan por múltiples rondas de modificación, el consumo de tokens puede ser enorme, lo que conlleva un costo muy alto. Por lo tanto, volví a revertir la integración de traducción de OpenCode, cambiando a una traducción normal de una sola pasada.

Para resolver este problema, reestructuré completamente el directorio de generación de CZON. A partir de la versión 0.6.0, CZON copiará los archivos fuente tal cual al directorio de generación, manteniendo la misma ruta. Por ejemplo, `docs/guide/intro.md` se escribirá en `.czon/src/{lang}/docs/guide/intro.md`. De esta manera, al modificar un artículo, solo es necesario volver a traducir ese artículo, evitando la regeneración en avalancha. (Sin embargo, los usuarios de versiones anteriores de CZON necesitarán regenerar todo el directorio `.czon/src`, lo que requiere volver a traducir todos los artículos una vez).

Una vez cortada la cadena de regeneración en avalancha, el siguiente paso es optimizar el consumo de tokens de la traducción generativa adversaria. Descubrí que el Agente de generación adversaria a veces lee excesivamente otros archivos; por ejemplo, en una tarea de traducción de zh-Hans a es-ES, el Agente de traducción lee contenido en en-US. Esto claramente es un consumo innecesario de tokens. Sin embargo, OpenCode actualmente no puede restringir los permisos de acceso a archivos del Agente a nivel de sesión. Un pequeño truco es copiar los archivos necesarios a un directorio temporal y luego permitir que el Agente acceda solo a ese directorio. Todavía estoy considerando si hacer esto. ¿Se puede reducir este acceso innecesario a archivos mediante indicaciones detalladas? ¿O es más seguro usar directamente un directorio temporal?

Después de modificar la estructura del directorio de generación de CZON, esto significa que el ID SHA-256 Hash, que antes era dominante, casi no tiene utilidad. El protocolo `czon://hash` también quedó obsoleto. Sin embargo, después de la reestructuración, el reemplazo de enlaces es más elegante. Antes y después de la traducción, estos enlaces no necesitan ser reemplazados en absoluto, y al renderizar HTML, se pueden reemplazar por las rutas correctas mediante hooks.

Ahora, este diseño de la estructura del directorio `.czon` es más amigable para git y la integración con SSG de terceros.

-   Porque cada directorio `.czon/src/{lang}` es un directorio completo que puede ser renderizado o previsualizado por separado.
-   El uso de rutas en lugar de Hash hace que, al modificar un archivo fuente, no se cree un nuevo archivo de destino, sino que se sobrescriba el archivo de destino existente, evitando la generación de una gran cantidad de archivos redundantes.

### Referencia a Recursos Estáticos

Los recursos estáticos se pueden referenciar mediante enlaces normales.

En la versión 0.6.0 de CZON, también se pueden referenciar archivos de recursos arbitrarios, como imágenes, PDF, etc. Estos archivos de recursos se copiarán a la ubicación correspondiente en el directorio de generación. No solo imágenes, sino también txt, pdf, docx, etc., pueden ser referenciados. CZON manejará automáticamente la copia de estos archivos de recursos.

### Optimización Adicional

**Separación de las Tareas de Traducción de Metadata**

Yendo un paso más allá, el YAML FrontMatter o Metadata también debería permanecer en `.czon/meta.json`, sin necesidad de ser mejorado (enhanced) previamente al principio del Markdown. Incluso, este YAML FrontMatter en sí mismo pierde sentido.

```mermaid
flowchart TD
    A[Archivo Markdown Fuente] --> B["MetaData Extraída (almacenada en idioma fuente)"]
    A --> F[Archivo HTML en idioma fuente]
    A --> C[Archivo Markdown traducido al idioma objetivo]
    B --> D["MetaData Traducida (almacenada en idioma objetivo)"]
    D --> E
    C --> E[Archivo HTML en idioma objetivo]
    B --> F
```

**Eliminación Automática de Archivos Residuales en `.czon/src`**

Actualmente, CZON no elimina los archivos sobrantes en el directorio `.czon/src/{lang}`. Por ejemplo, si se elimina un artículo, `.czon/src/{lang}/path/to/deleted-article.md` aún existe. En futuras versiones, CZON detectará automáticamente estos archivos sobrantes y los eliminará, manteniendo el directorio de generación ordenado.

**Reactivación de la Traducción Generativa Adversaria**

Esto es inevitable. Porque la traducción de una sola pasada (one-shot) simplemente no puede manejar artículos largos. El uso de Agentes es imprescindible, pero es necesario resolver el problema del consumo excesivo de tokens.