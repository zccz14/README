---
"title": "システム権限とAI資産化に関する考察"
"summary": "本稿は、四つの核心的な議題について論じます。第一に、Yuanシステムの権限における非対称設計の必要性について、データを開放する前に適切な権限制御メカニズムを確立し、異なる戦略プラットフォームがデータや注文インターフェースにアクセスできるようにする重要性を強調します。第二に、AI資産化の初期形態と将来のトレンドを分析し、API管理における仲介業者の機会とBYOKの長期的な可能性を指摘します。第三に、Supabaseを基盤としたユーザーシステム強化案を提案し、Edge Functionを用いたPassKeyによるパスワードレス認証の実現方法を示します。最後に、決済システムのコンプライアンス対応の必要性に触れます。本稿は、技術チームがシステム設計、AIビジネス開発、ユーザー体験最適化において実用的な知見を得ることを目的としています。"
"tags":
  - "権限設計"
  - "AI資産化"
  - "ユーザーシステム"
  - "Supabase"
  - "PassKey"
  - "決済システム"
  - "Yuanシステム"
  - "API管理"
"date": "2026-02-04"
---

# いくつかのToDo

現在は2026年2月4日、0時です。

一日中働きましたが、全体的にはAIに作業をさせながら考える過程でした。少し眠いので、明日また続けます。

いくつかやる価値のあることを記録しておきます。

## 一、我々のシステムを開放する

Yuanのホスト内の権限、ホストへの接続権限は非対称設計が可能でしょうか？つまり、すべての端末がホストに接続した後、同じ権限を得るわけではないということです。これは権限をより良く制御するのに役立ち、結果として我々のデータをより良く開放できるようになります。現在、ホスト内の権限メカニズムが欠如しているため、一部のデータソースを一時的に閉鎖せざるを得ず、AIに自由に公開することも躊躇しています。これが最終的に実験の進捗に影響を与えています。

具体的には、SQLを読み取る権限は与えられるか？SQLを書き込む権限は与えられるか？Methodレベルでは、デフォルトでアクセス可能とするか、デフォルトで禁止とするか？認可はどのように行うべきか？これらの問題はしっかりと設計する必要があります。

利点としては、Yuan CLIに高い権限を与えることで、AIがより良く作業できるようになることです。

将来的に、Yuanはデータソースおよび注文プラットフォームになる可能性があります。そして、その中間にある戦略は百花繚乱となるでしょう。現時点では、Yuanに組み込まれたKernel+Agent体系の戦略プラットフォームに加え、鶏哥が作成したTimeLab戦略プラットフォーム、そして私が最近取り組んでいる持久戦実験リポジトリがあります。これらは異なる設計理念と技術スタックに基づいており、将来的に共存する可能性があります。しかし、これらの戦略プラットフォームはすべてYuanのデータと注文インターフェースへのアクセスを必要とします。

したがって、どのように権限体系を設計するかは重要な問題です。**開放するには、まず防御を固めなければならない**（奉化なまり）。

## 二、AI資産化の能力

最近、いくつかの中継APIを使用していますが、それらはNew APIというプロジェクトを利用してユーザー管理と課金を行っていることに気づきました。それらは本質的に、自身のサブスクリプションプールを資産化し、卸売りから小売りへ転換し、ユーザーに販売しています。しかし、このような販売方法では、ビジネスに紐づかないため、高値で売ることができません。ここでの価格交渉力は、上流のビジネス側に譲渡されています。

ある意味では、これらはAI APIの資産化であり、AI資産化の初期形態に属します。一方、上流のAI製品を構築する際には、基盤となるAPI資産を活用し、上流のビジネスを円滑に進めることができます。これにより、ユーザーはAPI設定の複雑さに直接直面する必要がなくなり、ユーザー体験が向上します。直接製品をサブスクリプションするか、従量課金制の製品を利用するのです！ユーザーは組み合わされた後の製品のみを気にし、基盤のAPIがどのように設定されているかは気にしません。ここにももう一つの利益の余地があります。

現在、API KEYの管理は、一般ユーザーにとって依然としてハードルです。多くのユーザーはAPI KEYの概念を理解しておらず、申請や管理の方法さえ知りません。したがって、AIビジネスの仲介業者には、依然として大きな機会があります。これは実際には認知の差の問題です。この種の利益は非常にスケーラブルです。

もちろん、将来的にはBYOKがトレンドになることは間違いないと考えています。ユーザーは自身のAPI Keyを使用することで、データ漏洩の問題を回避したいと望むでしょう。一方で、ユーザーは仲介業者にマージンを取られるのではなく、APIコスト価格でAIサービスを購入したいとも考えています。実際、仲介業者も多くのビジネスアセンブリを行っており、それには価値があります。ビジネス側におけるBYOKはオプションとして提供可能ですが、API KEYの概念が十分に普及するまでのここ数年は、BYOKは主流にはならないでしょう。

## 三、ユーザーシステムの強化

Supabaseは依然として優れた選択肢ですが、そのユーザーシステムにはいくつかの不足点があります。例えば、PassKeyのようなパスワードレス認証方式をサポートしていません。SupabaseがPassKeyをサポートするための一つの案を考えました。それは以下のアイデアに基づいています：

**Edge Function内でadmin（service_role）権限を用いて特定のユーザーのSupabaseセッションを作成し、access_token / refresh_tokenを取得してフロントエンドに返す。**

- Supabaseには「adminが任意のユーザーのセッションを直接生成する」公式APIは存在しません。
- 公式推奨の方法：バックエンド（Edge Function）で `auth.admin.generateLink` + `auth.verifyOtp` の組み合わせを使用し、magic linkログインフローをシミュレートすることで、該当ユーザーのセッションオブジェクト（その中にaccess_token / refresh_tokenなどが含まれる）を取得する。
- このフローはEdge Function内部で完全に完了させることが可能で、実際にユーザーにメールを送信したり、ユーザーがリンクをクリックする必要はありません。

したがって、Edge Functionを通じてPassKeyログイン機能を完全に実装することができます。これにより、Supabaseを基盤としたユーザーシステムでは、メールアドレスで登録し、メールアドレスでログインし、さらにPassKeyでログインすることが可能になります。このプロセス全体はパスワードレスであり、ユーザー体験は向上します。ただし、PassKeyは重いインタラクション方式であるため、すべての操作に使用するのには適していません。初期ログインや、パスワード変更、決済方法変更などの重要な操作にのみ紐づけるのが適切です。通常のセッション維持には、Supabaseのaccess_token / refresh_tokenメカニズムをそのまま再利用すればよく、JWTメカニズムは十分に有用です。

## 四、決済システム

非常に古くて現実的な問題です。どうやってユーザーに支払ってもらうか？どうやってコンプライアンスに則って会社の受取口座に入金するか？どうやってQRコードを紐づけ、ユーザーがスキャンして支払い、そのお金が会社の口座に入るようにするか？これらの問題はすべて解決する必要があります。

我々にはいくつかの案があり、決済プラットフォームと連携することはおそらく良い選択肢の一つです。必ずプロセスを踏む必要があります。後日、改めて共有します。