現在は2026年2月10日、夜です。

# 三体ゲーティングの市場状態量モデリング案

[三体動力学仮説](../INSIGHTS/9.md) および [ゲーティング機構の構想](./59.md) を踏まえ、本稿では $\delta$, $\mu$, $\sigma$ という3つの市場状態量の具体的なモデリング案を整理します。

入力：ローソク足系列 $(O_t, H_t, L_t, C_t, V_t)$。

## 1. $\mu$（モメンタム）：収益率の移動平均

対数収益率を $r_t = \ln C_t - \ln C_{t-1}$ とし、モメンタムを収益率の指数移動平均と定義します：

$$\mu_t = \text{EMA}(r_t, n_\mu)$$

$\mu$ は価格系列にバンドパスフィルタを適用した出力であり、「中域」の方向性のある動き——すなわちトレンド——を抽出します。高周波ノイズは EMA によって平滑化され、低周波のドリフトは $r_t$ 自体が差分であるため除去されます。

これは二本移動平均戦略の信号の本質と同じです：$\text{EMA}_{fast} - \text{EMA}_{slow}$ もまた $r_t$ の線形フィルタです（厳密に証明可能）。ただインパルス応答の形状が異なるだけです。したがって $\mu$ のモデリングに議論の余地はなく、あらゆるモメンタム指標は $r_t$ の線形関数であり、違いはフィルタパラメータのみです。

## 2. $\sigma$（ボラティリティ）：収益率の標準偏差

$$\sigma_t = \text{StdDev}(r_t, n_\sigma)$$

これは、ローリングウィンドウ内の対数収益率の標準偏差です。最も古典的な実現ボラティリティの推定であり、オプション価格設定において広く使用されています。

$\sigma$ の計算には、平方（または絶対値の取得）という重要な非線形操作が含まれます。これにより方向情報が捨てられ、振幅のみが保持されます。信号処理の観点から見ると、これは**包絡線検出**操作です：まず信号の絶対値/平方を取る（非線形整流）、次にローパスフィルタをかける（ローリングウィンドウ平均）、これにより振動振幅の緩やかな変化が得られます。

まさにこの非線形操作のため、$\sigma$ と $\mu$ の間には線形関係が存在せず、両者は独立した情報次元となります。

## 3. $\delta$（プレミアム）：出来高引力場モデル

### 3.1 なぜ $\delta$ を移動平均からの乖離で定義できないか

仮説では $\delta = (S - S^*) / S^*$ です。もし移動平均線を $S^*$ として使用する場合、以下のことが厳密に証明できます：

$$\ln S_t - \text{EMA}(\ln S_t, N) = \frac{\lambda}{\alpha} \cdot \text{EMA}(r_t, N)$$

ここで $\lambda = 1 - \alpha$ です。つまり、**価格の移動平均からの乖離は、同周期の EMA(r) の定数倍に厳密に等しい**ということです。

これは、移動平均で定義された $\delta$ が $\mu$ と線形従属関係にあり、独立した次元を構成しないことを意味します。単一の移動平均であれ、多段階の移動平均であれ、線形フィルタである限り、$\delta$ は $\mu$ の変形に帰着してしまいます。

$\delta$ を独立させるためには、非線形操作を導入する必要があります。

### 3.2 内在的価値は市場内生的である：心理的アンカリング効果

我々は、内在的価値 $S^*$ は市場の外生変数ではなく、市場参加者が取引行動を通じて「投票」して生み出す合意価格であると考えます。

核心となる観察：**売り手と買い手が価格について合意して初めて出来高が発生する**。出来高が大きい価格帯は、市場がその価格に対する承認度が高いことを意味し、心理的アンカリング効果が強くなります。

したがって、$S^*$ は単一の値ではなく、出来高の価格軸上の分布です。出来高が集中する領域が合意領域（ボックス相場の領域、サポート・レジスタンス帯）であり、出来高が疎な領域が非合意領域（価格が急速に通過する領域）です。

### 3.3 離散的なアンカー点から連続的な引力場へ

自然な考え方は、まず出来高集中領域（アンカー点）を識別し、次に価格のアンカー点からの乖離を計算することです。しかし、アンカー点の識別自体がピーク検出を必要とし、追加のモデリング層とパラメータを導入することになります。

よりクリーンな方法：**アンカー点を明示的に識別せず、各取引が直接現在価格にアンカリング効果を及ぼすようにする**。

価格 $P_i$ で成立した量 $V_i$ の各取引は、現在価格 $S_t$ に対して「引力」を発生させます。アンカー点を定義する必要はありません——それらは引力場の高密度領域として自然に創発します。

### 3.4 カーネル関数 $K(S, P)$：アンカリング効果の心理モデル

カーネル関数 $K(S, P)$ は、**$P$ で取引した人が、価格が $S$ に変化したとき、そのアンカリング効果がどれほど強いか**を記述します。

ガウシアンカーネルを選択します：

$$K(S, P) = \exp\left(-\frac{(S - P)^2}{2h^2}\right)$$

$h$ はバンド幅パラメータであり、アンカリング効果の作用半径を意味します。$h$ を現在のボラティリティ $\sigma$ の倍数に設定することで、市場状態に適応させることができます——ボラティリティが高いとき、人々の「適正価格」に対する許容範囲はより広くなります。

カーネル関数の形状は心理的仮定をコード化しており、異なるカーネルは異なる $\delta$ を生成し、ひいては異なるゲーティング効果を生み出します。ゲーティング効果の良し悪しは、どの心理モデルが現実に近いかを逆に検証します。

第一版では対称ガウシアンカーネルを使用します。しかし、カーネル関数は非対称である可能性があります。その理由は以下の通りです：

各取引には買い手と売り手がいます。一見すると、買い手の損失側（$S < P$）と売り手の損失側（$S > P$）は方向が逆であり、非対称性は相殺されるはずです。しかし、**処分効果**がこの対称性を破ります——人々は利益が出ているポジションを売り、損失が出ているポジションを保有する傾向があります。これは、利益側が徐々に市場から離脱し（アンカリング効果が消失）、損失側が市場に残り続ける（アンカリング効果が持続）ことを意味します。この「生存者選抜」を経た後、市場に残存するアンカリング効果は自然と損失側に偏ります。

さらに、多くの市場（株式、暗号資産）では**ロングバイアス**が存在します——ロング（買い）の参加者はショート（売り）の参加者よりもはるかに多いのです。したがって、集約効果は次のようになります：$S < P$（ロングの損失側）のアンカリング効果がより強く、$S > P$（ロングの利益側）のアンカリング効果がより弱い。これは経験的観察——サポートラインは通常レジスタンスラインよりも「硬い」——と一致します。

将来は、この非対称性をモデル化し、ゲーティング効果の比較を通じてその有意性を検証するために、分割正規カーネル（左右のバンド幅が異なるガウシアンカーネル）の使用を検討することができます。

### 3.5 $\delta$ の定義：引力場の勾配

出来高引力場を定義します：

$$F(S) = \sum_i V_i \cdot e^{-\kappa(t - t_i)} \cdot K(S, P_i)$$

ここで $e^{-\kappa(t - t_i)}$ は時間減衰です——より古い取引ほど、アンカリング効果は弱くなります。

$\delta$ を、引力場の価格に対する**負の勾配**（すなわち「引き戻す力」の方向と大きさ）と定義します：

$$\delta_t = -\frac{\partial F}{\partial S}\bigg|_{S=S_t} = \sum_i V_i \cdot e^{-\kappa(t - t_i)} \cdot \frac{P_i - S_t}{h^2} \cdot \exp\left(-\frac{(S_t - P_i)^2}{2h^2}\right)$$

振る舞いの特徴：

- $S_t$ が出来高集中領域の中心にある場合：両側の引力が対称的に相殺され、$\delta \approx 0$（プレミアムなし）
- $S_t$ が集中領域から乖離している場合：引力が非対称になり、$\delta$ は集中領域を指す（プレミアムあり、回帰力が存在）
- $S_t$ がすべての出来高領域から遠く離れている場合：すべての引力が非常に弱い（未知の領域に入り、アンカリング効果が消失）

## 4. ローソク足系列からの具体的計算

### 4.1 $\mu$ と $\sigma$ の計算

終値系列から直接計算します。特別な処理はありません：

```python
r[t] = log(C[t]) - log(C[t-1])
μ[t] = EMA(r, n_μ)[t]
σ[t] = StdDev(r, n_σ)[t]
```

### 4.2 $\delta$ の計算：価格軸の離散化

すべての履歴取引を逐次累積するのは現実的ではありません。実用的な方法は、価格軸を $N$ 個のビンに離散化し、引力質量ベクトル $G[1..N]$ を維持することです。

**ステップ 1：ローソク足出来高の配分**

各ローソク足の出来高 $V_t$ を価格軸上に配分する必要があります。ローソク足は OHLCV のみを提供し、逐次データは提供しません。合理的な近似の一つ：$V_t$ を $[L_t, H_t]$ の範囲内のすべてのビンに均等に配分します。

```python
for bin_j in bins_between(L[t], H[t]):
    G[j] += V[t] / count_of_bins_between(L[t], H[t])
```

**ステップ 2：時間減衰**

新しいローソク足が到来するたびに、$G$ ベクトル全体に時間減衰を適用します：

```python
G[:] *= exp(-κ)
```

**ステップ 3：$\delta$ の計算**

```python
δ[t] = Σ_j G[j] · (P_j - S[t]) / h² · exp(-(S[t] - P_j)² / (2h²))
```

ガウシアンカーネルの急速な減衰により、$S_t$ 近傍の数個のビン（例えば $|P_j - S_t| < 3h$ の範囲）のみを合計すれば十分です。

### 4.3 ビンの設計

対数価格軸上で等間隔にビンを分割することをお勧めします。こうすると、各ビンは同じパーセンテージの価格区間を表します。ビンの幅は $h$ よりも十分に小さくして、カーネル関数の滑らかさを保証する必要があります。

## 5. 三変量の独立性

| 変数のペア | 独立である理由 |
| ------ | ---------- |
| $\mu$ vs $\sigma$ | $\sigma$ の計算には平方/絶対値操作（非線形）が含まれ、方向情報を捨てている |
| $\delta$ vs $\mu$ | $\delta$ は出来高の価格軸上の分布に基づく（カーネル密度推定 + 勾配）。$\mu$ は収益率の線形フィルタに基づく。カーネル密度推定は非線形操作であり、さらに $\delta$ の入力には出来高 $V_t$ が含まれる。これは $\mu$ が全く使用しない情報である |
| $\delta$ vs $\sigma$ | 同様に、$\delta$ は出来高分布構造に依存し、$\sigma$ は収益率の振幅のみに依存する |

重要な点：$\delta$ の独立性は、二つの非線形操作——カーネル関数（ガウス指数）と勾配計算——および追加の情報源（出来高）に由来します。これにより、移動平均乖離案において $\delta$ が $\mu$ の変形に帰着する問題を根本的に回避しています。

## 6. パラメータまとめ

| パラメータ | 意味 | 推奨範囲 |
| ---- | ---- | -------- |
| $n_\mu$ | モメンタム平滑化ウィンドウ | 信号戦略の移動平均パラメータと一致させる |
| $n_\sigma$ | ボラティリティ計算ウィンドウ | $n_\mu$ と同じか、やや大きくする |
| $h$ | カーネル関数バンド幅（アンカリング効果作用半径） | $c \cdot \sigma_t$ と設定し、適応的に変化させる |
| $\kappa$ | 時間減衰率（アンカリング効果忘却速度） | 実験的に決定する必要あり |

ここで $h = c \cdot \sigma_t$ という設計により、バンド幅が市場状態に適応します：ボラティリティが高いときはアンカリング効果の作用範囲が広く、低いときは狭くなります。$c$ は無次元定数です。

## 参考文献

- [資本市場の三体動力学仮説](../INSIGHTS/9.md)
- [ゲーティング機構の構想](./59.md)
- [アンチマーチンベット戦略の実験結果](./58.md)