---
"title": "資本持久戦 実験設計"
"summary": "本稿では、資本持久戦の実験設計について詳細に説明します。中核となるのは、ベンチマークアカウントを参照とし、ベッティングアカウントがAnti-Martingale戦略を用いてポジションサイズを動的に調整する点です。主な内容は以下の通りです：離散的な市場時点を表す時間目盛りt；固定ポジションで取引を行い累積損益曲線を提供するベンチマークアカウント；ベンチマークのパフォーマンスに基づいて入力キャッシュフローC(t)とベンチマーク損切り額StopLoss(t)を計算し、リスクラインRiskLine(t)とリスク資金VC(t)を構築するベッティングアカウント；式Position(t) = floor(VC(t) / StopLoss(t))によってポジションサイズを決定します。また、利益確定と損切りイベントの処理ロジック、および観察期間における取引停止条件を定義しています。全体として、リスク資金の利用効率を最大化し、積極的かつ制御されたベッティングを実現することを目的としています。"
"tags":
  - "資本持久戦"
  - "実験設計"
  - "Anti-Martingale"
  - "資金管理"
  - "リスク管理"
  - "ポジション計算"
  - "ベンチマークアカウント"
  - "ベッティングアカウント"
"date": "2026-02-02"
---

# 資本持久戦 実験設計

2026-02-02

AIが記述したコードの詳細はまだ改善の余地があるため、基礎となる実験設計の概念を再整理します。

## 時間目盛り t

時間目盛り t は離散的であり、市場の各時点を表します。分、時間、日などが考えられます。通常は各ローソク足を指します。以降、多くの時系列について議論しますが、それらの独立変数はすべて t です。

## ベンチマークアカウント

ベンチマークアカウントは、いかなる資金管理戦略も使用しないアカウントです。常に初期ポジション1単位で取引を行います。ベンチマークアカウントのパフォーマンスは、ベッティングアカウントの資金管理を導くために使用されます。

- **ベンチマークアカウントの累積損益** BasePnL(t): 時系列。初期値は0。常に初期ポジション1単位で取引を行います。これによって得られる累積損益曲線です。

## ベッティングアカウント

ベッティングアカウントは、Anti-Martingale資金管理戦略を使用し、ベンチマークアカウントのパフォーマンスに基づいてポジションサイズを動的に調整します。

重要パラメータ：

- **目標利益確定金額** M_T: ベッティング戦略のパラメータによって決定されます。

考察対象：

- **未実現損益** UnrealizedPnL(t): 時系列。ベンチマークアカウントの現在保有ポジションの未実現損益を表します。初期値は0。

- **実現済み損益** RealizedPnL(t): 時系列。ベンチマークアカウントが既に実現した損益を表します。初期値は0。

- **累積損益** PnL(t): 時系列。システムが生み出す損益を表します。常に PnL(t) = UnrealizedPnL(t) + RealizedPnL(t) が成り立ちます。この PnL が正味価値曲線です。任意の初期資金規模に線形スケーリングできます。ベッティングモデルのパフォーマンスは PnL(t) を通じて観察できます。

### リスク管理

#### 入力キャッシュフローの決定

**入力キャッシュフロー** C(t): 時系列。入力キャッシュフローの速度（総量ではありません）を表します。

ベンチマークアカウントの過去のパフォーマンスに基づいて算出され、動的に更新されます。

推奨される計算方法は、ベンチマークアカウントの各取引において、最大の「損失/時間長」を C(t) の値として計算することです。

#### 厳格なリスクラインの構築

**リスクライン** RiskLine: 初期値は0。

基本的に RiskLine(t+1) = RiskLine(t) - C(t) で反復的に更新され、利益確定時には RiskLine は0にリセットされます。

リスクラインは時間の経過とともに下方に移動します。いかなる時点でも、UnrealizedPnL(t) >= RiskLine(t) が保証されます。

**リスク資金** (Venture Capital, VC)

常に VC(t) = UnrealizedPnL(t) - RiskLine(t) が成り立ちます。これは現在ベッティングに利用可能で、完全な損失リスクを負担する資金を表します。リスク資金は常に非負です。

### ポジションサイズの決定

原則として、リスク管理条件下で、リスク資金の利用効率を最大化するために可能な限り積極的にベッティングします。リスク資金を無駄にする行為は無意味です。各ポジションサイズは、VC(t) を完全に失う覚悟で最大損失を目指すものであり、リスク資金を一切無駄にしません。

**ベンチマーク損切り額** StopLoss(t)

現在の単位ポジションあたりに設定する最大の評価損額、つまり保有中の損切り額を表します。保有中にこの損切りラインに触れると、その時点でポジションが解消されます。ベンチマーク損切り額は、ベンチマークアカウントの過去のパフォーマンスに基づいて算出され、動的に更新されます。

推奨される計算方法は、ベンチマークアカウントの各取引において、最大の保有中評価損を StopLoss(t) の値として計算することです。最終的な損益ではなく、保有中の評価損を計算することに注意してください。ロングポジションは最安値、ショートポジションは最高値を使用して計算します。

**ポジションサイズ** は非負の整数であり、ベンチマークアカウントのポジションに対するベッティングアカウントのポジションの倍数を表します。

```pseudocode
if StopLoss(t) > 0 then
    Position(t) = max(1, floor(VC(t) / StopLoss(t)))
else
    Position(t) = 0
end if
```

StopLoss(t) = 0.01、VC(t) = 1 の場合、ベンチマークポジションの100倍のポジションを建てることになります。これは非常に積極的なポジションに見えます。例えば、BTC契約の最低取引額が0.0001 BTCであれば、100倍のポジションでも0.01 BTCのポジションに過ぎず、それほど恐ろしいものではありません。ただし、この倍数が大きすぎて実際の取引で実現できない可能性がないか、引き続き観察する必要があります。

### 観察期間

C(t) が0、または StopLoss(t) が0の場合、観察期間を表し、取引は行わず、C(t) と StopLoss(t) のみを更新します。Position(t) は常に0です。

### 利益確定イベント

UnrealizedPnL(t) >= M_T の場合、利益確定イベントが発生し、利益確定処理が実行されます。利益確定は保有中に発生するため、UnrealizedPnL(t) は M_T に達することはあっても、超えることはできません。利益確定イベントをチェックする際には、保有中の最高評価益を使用する必要があり、ロングは最高値、ショートは最安値を使用して計算します。

利益確定イベントを記録し、RiskLine(t) = UnrealizedPnL(t) = 0 にリセットして、VC(t) = 0 とします。

```pseudocode
RealizedPnL(t) += M_T
UnrealizedPnL(t) = 0
RiskLine(t) = 0
```

既に観測された情報 C(t) と StopLoss(t) は変更されません。

### 損切りイベント

保有期間中の最大評価損 >= StopLoss(t) の場合、損切りイベントが発生し、損切り処理が実行されます。

損切りイベントを記録します。UnrealizedPnL(t) は最大で RiskLine(t) までしか戻すことができません。つまり、VC(t) = 0 となります。

ベンチマークアカウント、および既に観測された情報 C(t) と StopLoss(t) は変更されません。