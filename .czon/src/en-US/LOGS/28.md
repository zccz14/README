---
"title": "CZON Directory Structure Refactoring and Translation Optimization"
"summary": "This article details the major refactoring of the CZON documentation generation tool in version 0.6.0. The author first points out issues in previous versions where using Hash as the source file ID led to avalanche-style translation tasks when modifying articles, along with the challenge of excessively high token consumption for adversarial generation translation. To address this, CZON refactored the generation directory structure to copy source files as-is by path, thereby avoiding chain reactions of regeneration. The author also discusses methods to optimize adversarial generation translation token consumption, such as using temporary directories to limit file access. The article further introduces optimization directions like static resource referencing, separating Metadata translation tasks, and automatic cleanup of residual files, emphasizing that adversarial generation translation will be re-enabled in the future to handle long articles."
"tags":
  - "CZON"
  - "Directory Structure"
  - "Translation Optimization"
  - "Token Consumption"
  - "Documentation Generation"
  - "Static Resources"
  - "Metadata"
  - "Adversarial Generation"
"date": "2026-01-26"
---

It is now 4:00 AM on Monday, January 26, 2026.

### CZON Directory Structure Refactoring

The effectiveness of [adversarial generation translation](./27.md) mentioned previously is indeed good. However, an issue with CZON was discovered: it uses Hash as the ID for source files. This caused an avalanche of (1 + 9) * 3 = 30 translation tasks to be triggered after I modified an article referenced 9 times. Additionally, the token consumption for adversarial generation translation is approximately 10 times or more that of regular translation. For long articles undergoing multiple rounds of modifications, token consumption becomes very large, leading to high costs. Therefore, I rolled back the OpenCode translation integration again, switching back to using regular single-pass translation.

To solve this problem, I refactored the entire CZON generation directory. Starting from version 0.6.0, CZON will copy source files as-is to the generation directory, maintaining the same path structure. For example, `docs/guide/intro.md` will be written to `.czon/src/{lang}/docs/guide/intro.md`. This way, modifying an article only requires retranslating that specific article, avoiding avalanche-style regeneration. (However, users of previous CZON versions will need to regenerate the entire `.czon/src` directory, requiring retranslation of all articles once.)

After severing the chain of avalanche-style regeneration, the next step is to optimize token consumption for adversarial generation translation. I found that the adversarial generation Agent sometimes excessively reads other files. For instance, during a zh-Hans to es-ES translation task, the translation Agent might read en-US content. This is clearly unnecessary token consumption. However, OpenCode currently cannot restrict Agent file access permissions at the session level. A small trick is to copy the necessary files to a temporary directory and then allow the Agent to access only that temporary directory. I am still considering whether to implement this. Can detailed prompts reduce such unnecessary file access? Or is using a temporary directory a safer approach?

After modifying CZON's generation directory structure, the previously dominant SHA-256 Hash ID has become almost obsolete. The `czon://hash` protocol has also been deprecated. However, after refactoring, link replacement has become more elegant. Before and after translation, these links do not need to be replaced at all. During HTML rendering, hooks can be used to replace links with the correct paths.

This new `.czon` directory structure design is now more friendly for git and third-party SSG integration.

-   Because each `.czon/src/{lang}` directory is a complete, standalone directory that can be rendered or previewed individually.
-   Using paths instead of Hash means that modifying a source file does not create a new target file but overwrites the existing one, avoiding the generation of大量冗余文件.

### Static Resource Referencing

Static resources can be referenced via regular links.

In CZON version 0.6.0, arbitrary resource files such as images, PDFs, etc., can also be referenced. These resource files will be copied to corresponding locations in the generation directory. Not just images, but txt, pdf, docx, etc., can all be referenced. CZON will automatically handle the copying of these resource files.

### Further Optimization

**Separating Metadata Translation Tasks**

Going further, YAML FrontMatter or Metadata should also remain in `.czon/meta.json` and not be pre-enhanced into the beginning of the Markdown. In fact, the YAML FrontMatter itself might become unnecessary.

```mermaid
flowchart TD
    A[Source Markdown File] --> B["Extracted MetaData (stored in source language)"]
    A --> F[Source Language HTML File]
    A --> C[Translated Markdown File in Target Language]
    B --> D["Translated MetaData (stored in target language)"]
    D --> E
    C --> E[Target Language HTML File]
    B --> F
```

**Automatically Deleting Residual Files in `.czon/src`**

CZON currently does not delete多余的文件 in the `.czon/src/{lang}` directories. For example, if an article is deleted, `.czon/src/{lang}/path/to/deleted-article.md` still remains. In future versions, CZON will automatically detect these多余的文件 and delete them to keep the generation directory clean.

**Re-enabling Adversarial Generation Translation**

This is inevitable. Because one-shot translation simply cannot handle long articles. Using Agents is imperative, but the issue of excessive token consumption needs to be resolved.