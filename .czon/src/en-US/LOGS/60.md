It is currently the evening of February 10, 2026.

# Market State Variable Modeling Scheme for the Three-Body Gating

Building upon the [Three-Body Dynamics Hypothesis](../INSIGHTS/9.md) and the [Concept of the Gating Mechanism](./59.md), this article outlines the specific modeling scheme for the three market state variables: $\delta$, $\mu$, and $\sigma$.

Input: Candlestick sequence $(O_t, H_t, L_t, C_t, V_t)$.

## 1. $\mu$ (Momentum): Moving Average of Returns

Let the logarithmic return be $r_t = \ln C_t - \ln C_{t-1}$. Momentum is defined as the exponential moving average of returns:

$$\mu_t = \text{EMA}(r_t, n_\mu)$$

$\mu$ is the output of the price sequence after band-pass filtering, extracting the "mid-frequency" directional movement—i.e., the trend. High-frequency noise is smoothed out by the EMA, and low-frequency drift is removed because $r_t$ itself is a difference component.

This is essentially the same as the signal in a dual moving average strategy: $\text{EMA}_{fast} - \text{EMA}_{slow}$ is also a linear filter of $r_t$ (can be strictly proven), differing only in the impulse response shape. Therefore, there is no controversy in modeling $\mu$; any momentum indicator is a linear function of $r_t$, with the only difference being the filter parameters.

## 2. $\sigma$ (Volatility): Standard Deviation of Returns

$$\sigma_t = \text{StdDev}(r_t, n_\sigma)$$

This is the rolling window standard deviation of logarithmic returns. It is the most classic realized volatility estimator, widely used in option pricing.

The calculation of $\sigma$ involves a crucial nonlinear operation—squaring (or taking absolute values). This discards directional information, preserving only amplitude. From a signal processing perspective, this is an **envelope detection** operation: first, take the absolute value/square of the signal (nonlinear rectification), then apply low-pass filtering (rolling window averaging) to obtain the slow variation of oscillation amplitude.

Precisely because of this nonlinear operation, there is no linear relationship between $\sigma$ and $\mu$; they represent independent information dimensions.

## 3. $\delta$ (Premium): Volume Gravitational Field Model

### 3.1 Why $\delta$ Cannot Be Defined by Deviation from a Moving Average

In the hypothesis, $\delta = (S - S^*) / S^*$. If a moving average is used as $S^*$, it can be strictly proven that:

$$\ln S_t - \text{EMA}(\ln S_t, N) = \frac{\lambda}{\alpha} \cdot \text{EMA}(r_t, N)$$

where $\lambda = 1 - \alpha$. That is, **the deviation of price from its moving average is strictly equal to a constant multiple of the EMA(r) with the same period**.

This means that $\delta$ defined using a moving average is linearly correlated with $\mu$ and does not constitute an independent dimension. Whether using a single-layer moving average or multi-layer cascaded moving averages, as long as it is a linear filter, $\delta$ will degenerate into a variant of $\mu$.

To make $\delta$ independent, a nonlinear operation must be introduced.

### 3.2 Intrinsic Value is Endogenous to the Market: Psychological Anchoring Effect

We posit that intrinsic value $S^*$ is not an exogenous market variable but a consensus price "voted" on by market participants through trading behavior.

Core observation: **Volume occurs only when buyers and sellers reach a price consensus**. Price ranges with higher trading volume imply stronger market recognition and a stronger psychological anchoring effect for that price.

Therefore, $S^*$ is not a single value but a distribution—the distribution of volume along the price axis. Areas of high volume concentration are consensus zones (consolidation ranges, support/resistance bands), while areas of low volume are non-consensus zones (areas where price moves rapidly through).

### 3.3 From Discrete Anchor Points to a Continuous Gravitational Field

A natural idea is to first identify volume concentration zones (anchor points) and then calculate the price deviation from these anchors. However, anchor point identification itself requires peak detection, introducing an additional modeling layer and parameters.

A cleaner approach: **Do not explicitly identify anchor points; let each trade directly exert an anchoring effect on the current price**.

Each unit of volume $V_i$ traded at price $P_i$ exerts a "gravitational pull" on the current price $S_t$. Anchor points do not need to be defined—they naturally emerge as high-density regions of the gravitational field.

### 3.4 Kernel Function $K(S, P)$: Psychological Model of the Anchoring Effect

The kernel function $K(S, P)$ describes: **For a person who traded at price $P$, how strong is their anchoring effect when the price becomes $S$?**

We choose the Gaussian kernel:

$$K(S, P) = \exp\left(-\frac{(S - P)^2}{2h^2}\right)$$

$h$ is the bandwidth parameter, representing the radius of influence of the anchoring effect. $h$ can be set as a multiple of the current volatility $\sigma$, making it adaptive to market conditions—people tolerate a wider range of "reasonable prices" during high volatility.

The shape of the kernel function encodes psychological assumptions. Different kernels will produce different $\delta$, leading to different gating effects. The quality of the gating effect, in turn, validates which psychological model is closer to reality.

The first version uses a symmetric Gaussian kernel. However, the kernel function might be asymmetric for the following reasons:

Every trade involves both a buyer and a seller. At first glance, the loss side for the buyer ($S < P$) and the loss side for the seller ($S > P$) are opposite, and the asymmetry should cancel out. However, the **disposition effect** breaks this symmetry—people tend to sell winning positions and hold losing positions. This means profitable parties gradually exit the market (anchoring effect disappears), while loss-making parties remain in the market (anchoring effect persists). After this layer of "survivor screening," the residual anchoring effect in the market is naturally biased towards the loss side.

Furthermore, in most markets (stocks, cryptocurrencies), there exists a **long bias**—significantly more participants are long than short. Therefore, the aggregate effect is: the anchoring effect is stronger for $S < P$ (long loss side) and weaker for $S > P$ (long profit side). This aligns with empirical observation—support levels are typically "harder" than resistance levels.

In the future, a split normal kernel (Gaussian kernel with different left and right bandwidths) could be considered to model this asymmetry, and its significance could be verified by comparing gating effects.

### 3.5 Definition of $\delta$: Gradient of the Gravitational Field

Define the volume gravitational field:

$$F(S) = \sum_i V_i \cdot e^{-\kappa(t - t_i)} \cdot K(S, P_i)$$

where $e^{-\kappa(t - t_i)}$ is the time decay—older trades have a weaker anchoring effect.

$\delta$ is defined as the **negative gradient** of the gravitational field with respect to price (i.e., the direction and magnitude of the "pull-back force"):

$$\delta_t = -\frac{\partial F}{\partial S}\bigg|_{S=S_t} = \sum_i V_i \cdot e^{-\kappa(t - t_i)} \cdot \frac{P_i - S_t}{h^2} \cdot \exp\left(-\frac{(S_t - P_i)^2}{2h^2}\right)$$

Behavioral characteristics:

- $S_t$ at the center of a volume concentration zone: Gravitational pulls from both sides cancel symmetrically, $\delta \approx 0$ (no premium).
- $S_t$ deviates from a concentration zone: Gravitational pull becomes asymmetric, $\delta$ points towards the concentration zone (premium exists, regression force is present).
- $S_t$ far from all volume zones: All gravitational pulls are weak (entering uncharted territory, anchoring effect disappears).

## 4. Specific Calculation from Candlestick Sequence

### 4.1 Calculation of $\mu$ and $\sigma$

Calculated directly from the closing price sequence, no special handling:

```python
r[t] = log(C[t]) - log(C[t-1])
μ[t] = EMA(r, n_μ)[t]
σ[t] = StdDev(r, n_σ)[t]
```

### 4.2 Calculation of $\delta$: Discretization of the Price Axis

Accumulating all historical trades tick-by-tick is impractical. A practical approach is to discretize the price axis into $N$ bins and maintain a gravitational mass vector $G[1..N]$.

**Step 1: Candlestick Volume Allocation**

The volume $V_t$ of each candlestick needs to be allocated along the price axis. Candlesticks only provide OHLCV, not tick data. A reasonable approximation: uniformly distribute $V_t$ across all bins within the range $[L_t, H_t]$.

```python
for bin_j in bins_between(L[t], H[t]):
    G[j] += V[t] / count_of_bins_between(L[t], H[t])
```

**Step 2: Time Decay**

When a new candlestick arrives, apply time decay to the entire $G$ vector:

```python
G[:] *= exp(-κ)
```

**Step 3: Calculate $\delta$**

```python
δ[t] = Σ_j G[j] · (P_j - S[t]) / h² · exp(-(S[t] - P_j)² / (2h²))
```

Due to the rapid decay of the Gaussian kernel, summation is only needed over bins near $S_t$ (e.g., the range where $|P_j - S_t| < 3h$).

### 4.3 Bin Design

It is recommended to divide bins with equal spacing on the logarithmic price axis, so each bin represents the same percentage price interval. The bin width should be much smaller than $h$ to ensure the smoothness of the kernel function.

## 5. Independence of the Three Variables

| Variable Pair | Why Independent |
| ------------- | --------------- |
| $\mu$ vs $\sigma$ | Calculation of $\sigma$ involves squaring/absolute value operation (nonlinear), discarding directional information. |
| $\delta$ vs $\mu$ | $\delta$ is based on the distribution of volume along the price axis (kernel density estimation + gradient). $\mu$ is based on linear filtering of returns. Kernel density estimation is a nonlinear operation, and $\delta$'s input includes volume $V_t$, which is information $\mu$ does not use at all. |
| $\delta$ vs $\sigma$ | Similarly, $\delta$ depends on the volume distribution structure, while $\sigma$ depends only on the magnitude of returns. |

Key point: The independence of $\delta$ stems from two nonlinear operations—the kernel function (Gaussian exponential) and gradient calculation—as well as an additional information source (volume). This fundamentally avoids the problem in the moving average deviation scheme where $\delta$ degenerates into a variant of $\mu$.

## 6. Parameter Summary

| Parameter | Meaning | Suggested Range |
| --------- | ------- | --------------- |
| $n_\mu$ | Momentum smoothing window | Consistent with the moving average parameters of the signal strategy |
| $n_\sigma$ | Volatility calculation window | Same as $n_\mu$ or slightly larger |
| $h$ | Kernel function bandwidth (radius of anchoring effect) | Can be set as $c \cdot \sigma_t$, adaptive |
| $\kappa$ | Time decay rate (forgetting speed of anchoring effect) | Needs to be determined experimentally |

The design $h = c \cdot \sigma_t$ makes the bandwidth adaptive to market state: the anchoring effect has a wider range during high volatility and a narrower range during low volatility. $c$ is a dimensionless constant.

## References

- [Three-Body Dynamics Hypothesis of Capital Markets](../INSIGHTS/9.md)
- [Concept of the Gating Mechanism](./59.md)
- [Experimental Results of the Anti-Martingale Betting Strategy](./58.md)