---
"title": "Full-Spectrum Analysis: The Optimal Method for Monetizing Information"
"summary": "This paper proposes an improved Full-Spectrum Analysis (FSA) method based on the Kelly Criterion for optimal leverage decision-making in investment and trading. The method defines an outcome space, calculates expected and compound earning yields, and solves for the optimal leverage to maximize long-term compound growth. The document details the mathematical principles of FSA, its algorithmic implementation (including solving via Newton's method and handling black swan events), historical backtesting methods (such as Gross Profit Margin calculation), and the application of live trading modules. FSA aims to utilize imperfect probabilistic information by strictly adhering to the calculated optimal leverage, thereby lowering the quality threshold for information monetization and avoiding the limitations of traditional maximum likelihood methods."
"tags":
  - "Full-Spectrum Analysis"
  - "Kelly Criterion"
  - "Optimal Leverage"
  - "Compound Earning Yield"
  - "Investment Strategy"
  - "Risk Management"
  - "Algorithmic Trading"
  - "Probability Model"
"inferred_date": "2025-08-10"
"inferred_lang": "zh-Hans"
---

# Full-Spectrum Analysis: The Optimal Method for Monetizing Information

2025-08-10

## Background

**How to maximize the growth rate of assets?**

In 1956, J.L. Kelly published "A New Interpretation of Information Rate." The paper discussed how a gambler could use known information to maximize the compound growth rate of their assets. It proposed a probabilistic method to guide betting strategies. However, applying this paper to actual investment activities presents several issues:

1.  It does not utilize borrowing leverage or short selling, confining its conclusions to a practical leverage range of 0~1.
2.  It assumes the gambler bets on a specific event symbol, receiving a payout if it occurs next and losing the entire bet otherwise. However, traders can only bet on long/short positions, and the corresponding bullish/bearish events yield different results and returns across different time windows.
3.  **Liquidation Timing:** Kelly assumes the gambler cannot decide when the bet ends and liquidation occurs. In contrast, traders can decide to exit or continue holding at any time.
4.  **Redundant Bayesian Methods:** It assumes event development depends on prior and conditional probabilities. Removing the Bayesian framework does not affect the derived mathematical essence. Its inclusion increases complexity, making direct application of the paper's formulas difficult and requiring simplification for practical use.

We will adopt the probabilistic approach from Kelly's paper to explore a practical strategy applicable to the field of investment and trading.

## Full-Spectrum Analysis: Full-Spectrum Analysis, FSA

### Outcome Space, Optimal Leverage, and Optimal Yield

Assume implementing a certain trading strategy will result in several different outcome events. Let the outcome space be $X$. $X$ is non-empty (in practical scenarios, at least 2 outcomes exist).

We make additional assumptions:

1.  **Deterministic Returns:** Each outcome event corresponds to a definite rate of return. Let the return for outcome $i$ be $R_i$.
    1.  ✅ Events with different returns should be considered different outcome events. For example, a 1% profit and a 2% profit are different.
    2.  ❌ Grouping profit events with significantly different returns into the same outcome violates deterministic returns.
2.  **Deterministic Probabilities:** Let the probability of outcome $i \in X$ occurring be $P_i$, ($0 \le P_i \le 1$).
    1.  ✅ The probability of each outcome must be deterministically assessed.
    2.  ❌ Stating that an outcome has an "80% or higher chance" (80%～100%) violates deterministic probability.
3.  **Mutual Exclusivity:** Two outcomes cannot occur simultaneously.
    1.  ✅ Design outcome events that are completely impossible to occur together.
    2.  ❌ If outcome events have intersections, e.g., "holding for 20 minutes" and "falling 20%" could occur simultaneously, violating mutual exclusivity.
4.  **Completeness:** The sum of probabilities for all outcomes is 100%. No outcomes exist outside the predefined set, i.e., $\sum_{i \in X} P_i = 1$.
    1.  ✅ Consider all possible outcomes.
    2.  ❌ If outcome events are only defined as "rising over 20%" and "falling over 20%", without defining "fluctuating between -20% and 20%", completeness is violated.
5.  **Leverage Effect:** Returns follow the leverage effect. If using $k$ times leverage, when outcome $i$ occurs, the return is $k \cdot R_i$, meaning the asset becomes $1 + k \cdot R_i$ times its original value.
    1.  ✅ Investment products with sufficient liquidity conform to this characteristic.
    2.  ❌ When the position size becomes too large, market impact costs due to liquidity issues cause returns to deviate from a linear relationship.

For the outcome space $X$, we can calculate its **Expected Earning Yield**:
$$E(X) = \sum_{i \in X} P_i R_i$$

The concept of expected yield is intuitive and easy to calculate. Its problems are:

1.  It leads to extreme decisions—either zero or full position—failing to control bankruptcy risk. If the expected yield is positive, it tends to infinitely amplify leverage to seek higher returns, even if high leverage can lead to ruin.
2.  It does not consider the compounding effect. It only considers the return of a single investment, not that the market allows for repeated investments. This does not align with actual investment management.

**Compound Earning Yield** refers to the average return per trade after repeating multiple independent trades:

$$C(X, k) = (\prod_{i \in X} (1 + k \cdot R_i)^{P_i}) - 1$$

**Optimal Earning Yield** is the maximum compound yield across different leverage levels:

$$O(X) = \max_k C(X, k)$$

To avoid ruin (zeroing out), we must satisfy $1 + k \cdot R_i > 0$ for all outcomes, leading to a basic feasible region $K$ for k:

Upper bound:
$$\max k = \max(0, \min_{R_i < 0} {-\frac{1}{R_i}})$$

Lower bound:
$$\min k = \min(0, \max_{R_i > 0} {-\frac{1}{R_i}})$$

And an always feasible solution $k = 0$,
$$K = (\min k, \max k) \cup \{ 0 \}$$

The optimal leverage, $k_o$, is the $k$ within the feasible region $K$ that maximizes the compound yield $C(X, k)$.

$$k_o = \argmax_k C(X, k)$$

At any moment, we can calculate the actual leverage in the account: $k = \frac{\text{Position Size}}{\text{Account Equity}}$, and also evaluate the optimal leverage: $k_o$.
Ultimately, any trading strategy corresponds to an actual leverage. Making a deterministic trading decision is equivalent to determining the value of $k$. The optimal leverage corresponds to the ideal position.

Thus, we obtain a trading framework:

1.  Design the outcome space $X$.
2.  Continuously evaluate the probabilities $P$ of different outcomes.
3.  Calculate the actual leverage $k$ and the optimal leverage $k_O$.
4.  Control the actual leverage to approach the optimal leverage.

> **Special Points**
>
> The trivial point is $C(X, 0) = 0$, meaning "no participation, no profit or loss."
> When we have no position, it's equivalent to deciding $k = 0$. For any instrument, whether positioned or not, we are making a decision at every moment.
> Short selling corresponds to the case $k < 0$; if $|k| > 1$, it means additional leverage is required.

### Solving the Optimization Problem

Recap: Given outcome space $X$, probability distribution $P_i$, returns $R_i$, feasible region $[L, R]$, find the leverage rate $k \in [L, R]$ that maximizes the yield:

Rearranging the compound yield and taking the logarithm (preserving monotonicity), we get:

$$\ln (1 + C(X, k)) = \sum_{i \in X} P_i \ln (1 + k \cdot R_i)$$

Let

$$G(k) = \ln(1 + C(X, k)) = \sum_{i \in X} P_i \ln (1 + k R_i)$$

According to the definition of optimal leverage:

$$k_o = \argmax_k C(X, k)$$

Since $f(x) = \ln(1+x)$ is monotonically increasing:

$$k_o = \argmax_k C(X, k) = \argmax_k G(k)$$

Taking the first and second derivatives of $G(k)$:

$$G'(k) = \sum_{i \in X} \frac{P_i R_i}{1 + k R_i} $$

$$G''(k) = \sum\_{i \in X} -\frac{P_i R_i^2}{(1 + k R_i)^2} $$

Each term in the second derivative is non-positive, so $G''(k) \le 0$. $G''(k) = 0$ if and only if $P_i R_i \equiv 0$, but in that case, $G(k) \equiv 0$, yielding no profit and having no practical significance. In other cases, $G''(k) < 0$. This means $G(k)$ is a strictly concave function, and $G'(k)$ is strictly monotonically decreasing. $G(k)$ has exactly one maximum point, which is also the global maximum.

As shown in the figure below, regardless of the number of terms, the $G(k)$ curve is concave.

![Kelly Criterion - Curve Illustration](image-1.png)

The maximum point of $G(k)$ is the zero of its first derivative:

$$G'(k) = \sum_{i \in X} \frac{P_i R_i}{1 + k R_i} = 0$$

Rearranging this equation yields a polynomial equation in k.
If there are $N$ distinct values of $R_i$, the highest degree of this polynomial is $N-1$.
According to the Abel–Ruffini theorem, polynomials of degree five or higher have no general algebraic solution formula.

The common Kelly formula is a special case where $N=2$: Let win probability be $p$, and odds be $b$.

| Outcome | Probability | Return |
| ------- | ----------- | ------ |
| Win     | $p$         | $b$    |
| Loss    | $1-p$       | $-1$   |

Substituting gives the equation:

$$G'(k) = \frac{pb}{1+kb} + \frac{-(1-p)}{1 -k} = 0$$

Simplifying yields

$$k = \frac{p(b+1)-1}{b}$$

This proves the Kelly formula.

For trading scenarios, there may be countless outcomes with different returns; therefore, we can only seek numerical solutions.

As a strictly concave function of a single variable, Newton's method is the gold standard for solving.
Starting the iteration from the fixed point $$G(0) = 0$$ is a good choice; for a strictly concave function, iteration from any starting point converges to the same result.

#### Newton's Method Exceeding the Feasible Region

A potential issue is that the iteration point from Newton's method may fall outside the problem's feasible region.
A minimal example illustrates this:

$$p_1 = 0.9, r_1 = 0.5, p_2 = 0.1, r_2 = -1$$

Yields

$$G(k) = 0.9 \times \ln(1+0.5k) + 0.1 \times \ln(1 - k)$$

![G(k) Function Graph](image-2.png)

Calculation shows the feasible region $K = (-2, 1)$, with an analytical optimal leverage $k_o = 0.7$.
However, using Newton's method, the first iteration point is

$$k - \frac{G'(k)}{G''(k)} \text{ at } k=0 = \frac{14}{13} > 1$$

![G'(k) and Newton's Method Demonstration](image-3.png)

The first iteration point exceeds the feasible region, moving outside the domain where the derivative is defined, making further iteration meaningless. This shows the naive Newton's method itself cannot handle cases where the iteration point leaves the feasible region.

The solution is to check, after calculating the iteration point using Newton's method, whether it lies within the feasible region. If it does, iterate to that point. If not, based on its direction, take a point between the feasible region boundary and the current point as the next iteration point.

#### Algorithm Pseudocode

Algorithm $\text{resolve}(G, L, R, \epsilon = 10^{-9}, N = 100, \alpha = 0.9)$

1.  Initialize $k \gets 0$
2.  Calculate the basic feasible region $K$ based on returns $r_i$
3.  Clip the feasible region: $L \gets \max(L, \min K), R \gets \min(R, \max K)$
4.  Loop for a maximum of $N$ iterations:
    1.  Calculate the next point: $k' \gets k - \frac{G'(k)}{G''(k)}$
    2.  If $k'$ is not in $K$:
        1.  If $k' \ge R$, set $k' \gets \alpha R + (1-\alpha)k$
        2.  If $k' \le L$, set $k' \gets \alpha L + (1 - \alpha) k$
    3.  If the difference is below the precision threshold $| k' - k | < \epsilon$, break the loop.
    4.  Update $k \gets k'$
5.  Return $k$

#### Code Implementation

From a programming perspective, a more suitable abstraction is to let each outcome in the set have two attributes: return rate `r` and weight `w`. If this outcome space can be traversed, the algorithm can be written as:

```ts
/**
 * Calculates the optimal leverage k and expected return e based on the Kelly Criterion.
 *
 * @param R - Array of return rates
 * @param W - Array of weights (probabilities)
 * @param lower - Minimum leverage constraint
 * @param upper - Maximum leverage constraint
 * @param eps - Convergence tolerance
 * @param max_iter - Maximum number of iterations
 * @param alpha - Convergence acceleration factor
 * @returns An object containing the optimal leverage k and expected return e
 */
export function resolve_k(
  R: number[],
  W: number[],
  lower = -Infinity,
  upper = Infinity,
  eps = 1e-9,
  max_iter = 100,
  alpha = 0.9
) {
  const n = R.length;
  if (n !== W.length)
    throw new Error(
      "Returning and Probability vectors must have the same length"
    );

  // Calculate the basic feasible region K, ensuring 1 + k * r > 0
  let minK = NaN;
  let maxK = NaN;
  for (let i = 0; i < n; i++) {
    const r = R[i];
    if (r === 0) continue;
    const k = -1 / r; // Critical value
    if (r > 0) minK = isNaN(minK) ? k : Math.max(minK, k);
    if (r < 0) maxK = isNaN(maxK) ? k : Math.min(maxK, k);
  }
  if (isNaN(minK)) minK = 0; // If no positive R, set minK to 0
  if (isNaN(maxK)) maxK = 0; // If no negative R, set maxK to 0
  lower = Math.max(lower, minK);
  upper = Math.min(upper, maxK);

  let sum_w = 0;
  for (let i = 0; i < n; i++) {
    const w = W[i];
    if (w < 0) throw new Error(`Weight[${i}] = ${w} must be non-negative`);
    sum_w += w;
  }
  if (sum_w === 0) throw new Error("Sum of weights must be greater than zero");

  let k = 0;
  let it;
  for (it = 0; it < max_iter; it++) {
    let acc_g1 = 0;
    let acc_g2 = 0;
    for (let i = 0; i < n; i++) {
      const r = R[i];
      const w = W[i];
      acc_g1 += (w * r) / (1 + k * r);
      acc_g2 += (w * r * r) / (1 + k * r) ** 2;
    }
    const delta_k = acc_g1 / acc_g2;
    if (!(Math.abs(delta_k) > eps)) break;
    let next_k = k + delta_k;
    if (next_k <= lower) {
      next_k = lower * alpha + k * (1 - alpha);
    } else if (next_k >= upper) {
      next_k = upper * alpha + k * (1 - alpha);
    }

    k = next_k;
  }

  const lne =
    R.reduce((acc, r, i) => acc + W[i] * Math.log(1 + k * r), 0) / sum_w;
  const e = Math.exp(lne) - 1;

  return { k, e, it, sum_w, lne, upper, lower };
}
```

### Other Mathematical Properties

#### When the feasible region is unrestricted, a positive expected yield implies a positive optimal yield.

Proof:
Since $f(x) = \ln(1+x)$ has the same sign as $x$, the signs of $C(X, k)$ and $G(k)$ are the same.
Consider the derivative of $G(k)$ at $k = 0$: $G'(0) = \sum_{i \in X} P_i R_i$, which is precisely the expected yield $E(X)$.
For an infinitesimal $\Delta k$, by the definition of the derivative, $G(\Delta k) = G(0) + G'(0) \cdot \Delta k = E(X) \cdot \Delta k$.

If $E(X) > 0$, then there exists $\Delta k > 0$ such that $G(\Delta k) > 0$, i.e., $C(X, \Delta k) > 0$. Therefore, the optimal yield
$$O(X) = \max C(X,