---
"title": "Análisis de Espectro Completo: El Método Óptimo para Monetizar Información"
"summary": "Este artículo propone un método de Análisis de Espectro Completo (FSA) mejorado basado en el criterio de Kelly, para la toma de decisiones de apalancamiento óptimo en el ámbito de la inversión y el trading. El método define un espacio de resultados, calcula la tasa de rendimiento esperada y la tasa de rendimiento compuesto, y resuelve el apalancamiento óptimo para maximizar el crecimiento compuesto a largo plazo. El documento detalla los principios matemáticos del FSA, su implementación algorítmica (incluyendo la resolución por el método de Newton y el manejo de eventos 'cisne negro'), los métodos de backtesting histórico (como el cálculo del Margen Bruto de Beneficio, GPM) y la aplicación del módulo de trading en tiempo real. El FSA busca utilizar información probabilística imperfecta, reduciendo el umbral de calidad para monetizar la información al seguir estrictamente el apalancamiento óptimo calculado, evitando las limitaciones de los métodos tradicionales de máxima verosimilitud."
"tags":
  - "Análisis de Espectro Completo"
  - "Fórmula de Kelly"
  - "Apalancamiento Óptimo"
  - "Tasa de Rendimiento Compuesto"
  - "Estrategia de Inversión"
  - "Gestión de Riesgos"
  - "Trading Algorítmico"
  - "Modelo Probabilístico"
"inferred_date": "2025-08-10"
"inferred_lang": "es-ES"
---

# Análisis de Espectro Completo: El Método Óptimo para Monetizar Información

2025-08-10

## Antecedentes

**¿Cómo maximizar la tasa de crecimiento de los activos?**

En 1956, J.L. Kelly publicó "A New Interpretation of Information Rate" (Una nueva interpretación de la tasa de información). El artículo discutía cómo un apostador podía utilizar información conocida para maximizar la tasa de crecimiento compuesto de sus activos. Proponía un método probabilístico para guiar la estrategia de apuestas. Sin embargo, la aplicación de este artículo a actividades de inversión reales presenta varios problemas:

1.  No utiliza el apalancamiento mediante préstamo ni las ventas en corto, por lo que sus conclusiones se mantienen dentro del rango de apalancamiento real de 0~1.
2.  Supone que el apostador apuesta por un símbolo de evento, recibiendo un pago si ocurre la próxima vez, o perdiendo su apuesta en caso contrario. Pero los traders solo pueden apostar a largo/corto, y los eventos alcistas/bajistas correspondientes presentan resultados y tasas de rendimiento diferentes en diferentes ventanas temporales.
3.  Momento de liquidación: Kelly asume que el final y la liquidación de la apuesta no están determinados por la voluntad del apostador. Pero los traders pueden decidir en cualquier momento salir o mantener la posición.
4.  Método bayesiano redundante, que asume que el desarrollo de los eventos está relacionado con probabilidades previas y condicionales anteriores. Eliminar el método bayesiano no afecta la esencia matemática derivada. Aumenta la dificultad, haciendo que el uso directo de la fórmula del artículo sea complejo y requiera simplificación para su uso práctico.

Continuaremos utilizando el método probabilístico del artículo de Kelly para explorar una estrategia práctica aplicable al campo de la inversión y el trading.

## Análisis de Espectro Completo: Full-Spectrum Analysis, FSA

### Espacio de resultados, apalancamiento óptimo y tasa de rendimiento óptima

Supongamos que al implementar una estrategia de trading, finalmente habrá varios eventos de resultado diferentes. Sea el espacio de resultados $X$. $X$ no está vacío (en escenarios reales, existen al menos 2 resultados).

Hacemos algunas suposiciones adicionales:

1.  Rendimiento determinista: cada evento de resultado corresponde a una tasa de rendimiento definida. Sea $R_i$ la tasa de rendimiento del resultado $i$.
    1.  ✅ Eventos con diferentes tasas de rendimiento deben considerarse eventos de resultado diferentes, por ejemplo, una ganancia del 1% y una ganancia del 2% son diferentes.
    1.  ❌ Agrupar eventos de ganancia con rendimientos claramente diferentes en el mismo resultado viola el rendimiento determinista.
1.  Probabilidad determinista: sea $P_i$ la probabilidad de que ocurra el resultado $i \in X$, ($0 \le P_i \le 1$).
    1.  ✅ La probabilidad de cada resultado debe evaluarse de manera determinista.
    1.  ❌ Considerar que la posibilidad de que ocurra un resultado es superior al 80%: 80%～ 100%, viola la probabilidad determinista.
1.  Exclusividad mutua: es imposible que ocurran 2 resultados simultáneamente.
    1.  ✅ Se deben diseñar eventos de resultado que sean completamente imposibles de ocurrir al mismo tiempo.
    1.  ❌ Si los eventos de resultado tienen intersección, por ejemplo, los eventos "mantener posición 20 minutos" y "caída del 20%" pueden ocurrir simultáneamente, se viola la exclusividad mutua.
1.  Exhaustividad: la suma de las probabilidades de todos los resultados es del 100%, no existen resultados fuera de los resultados predefinidos, es decir, $\sum_{i \in X} P_i = 1$.
    1.  ✅ Se deben considerar todos los resultados posibles.
    1.  ❌ Si los eventos de resultado solo definen "subida >20%", "bajada >20%", y no definen "movimiento entre -20% y 20%", se viola la exhaustividad.
1.  Efecto de apalancamiento: la tasa de rendimiento sigue el efecto de apalancamiento, es decir, si se utiliza un apalancamiento de $k$ veces, cuando ocurre el resultado $i$, la tasa de rendimiento es $k \cdot R_i$, lo que significa que el activo se convierte en $1 + k \cdot R_i$ veces el original.
1.  ✅ Los productos de inversión con suficiente liquidez cumplen esta característica.
1.  ❌ Cuando el tamaño de la posición es demasiado alto, debido a problemas de liquidez, se generan costes de impacto de mercado y el rendimiento ya no sigue una relación lineal.

Para el espacio de resultados $X$, se puede calcular su **Tasa de Rendimiento Esperada (Expected Earning Yield)**:
$$E(X) = \sum_{i \in X} P_i R_i$$

El concepto de tasa de rendimiento esperada es bastante intuitivo y fácil de calcular. Los problemas de la tasa de rendimiento esperada son:

1.  Conduce a decisiones extremas, ya sea posición cero o posición máxima, sin poder controlar el riesgo de quiebra. Si la tasa de rendimiento esperada es positiva, tenderá a ampliar el apalancamiento infinitamente para buscar un rendimiento mayor, incluso si un alto apalancamiento puede llevar a la quiebra.
2.  No considera el efecto del interés compuesto. Solo considera el rendimiento de una inversión única, no considera que el mercado permite inversiones repetidas. No se ajusta a la realidad de la gestión de inversiones.

La **Tasa de Rendimiento Compuesto (Compound Earning Yield)** se refiere a la tasa de rendimiento promedio por operación después de realizar múltiples operaciones independientes y repetidas:

$$C(X, k) = (\prod_{i \in X} (1 + k \cdot R_i)^{P_i}) - 1$$

La **Tasa de Rendimiento Óptima (Optimal Earning Yield)** es el valor máximo de la tasa de rendimiento compuesto bajo diferentes niveles de apalancamiento:

$$O(X) = \max_k C(X, k)$$

Para evitar la quiebra (llegar a cero), se debe cumplir que para todos los resultados, $1 + k \cdot R_i >0$, lo que conduce a un dominio factible básico $K$ para k:

Límite superior:

$$\max k = \max(0, \min_{R_i < 0} {-\frac{1}{R_i}})$$

Límite inferior:

$$\min k = \min(0, \max_{R_i > 0} {-\frac{1}{R_i}})$$

Y una solución siempre factible $k = 0$,

$$K = (\min k, \max k) \cup \{ 0 \}$$

El apalancamiento óptimo es el $k$ dentro del dominio factible $K$ que maximiza la tasa de rendimiento compuesto $C(X, k)$.

$$k_o = \argmax_k C(X, k)$$

En cualquier momento, se puede calcular el apalancamiento real de la cuenta: $k = \frac{Tamaño\ de\ la\ posición}{Valor\ neto\ de\ la\ cuenta}$, y también se puede evaluar el apalancamiento óptimo: $k_o$.
Todas las estrategias de trading finalmente corresponden a un apalancamiento real. Tomar una decisión de trading determinista equivale a decidir el valor de $k$. Y el apalancamiento óptimo corresponde a la posición ideal.

Así obtenemos un marco de trading:

1.  Diseñar el espacio de resultados $X$.
2.  Evaluar continuamente las probabilidades $P$ de los diferentes resultados.
3.  Calcular el apalancamiento real $k$ y el apalancamiento óptimo $k_O$.
4.  Controlar que el apalancamiento real se acerque al apalancamiento óptimo.

> **Puntos especiales**
>
> Punto trivial $C(X, 0) = 0$, es decir, "sin participación no hay ganancias ni pérdidas".
> Cuando no tenemos posición, es equivalente a decidir que $k = 0$. Para cualquier producto, con o sin posición, en cada momento estamos tomando una decisión.
> Venta en corto corresponde al caso $k < 0$; si $|k| > 1$, significa que se necesita apalancamiento adicional.

### Resolución de la optimización

Repasando el problema, conocido el espacio de resultados $X$, la distribución de probabilidad $P_i$, el rendimiento $E_i$, el dominio factible $[L, R]$, encontrar el ratio de apalancamiento $k \in [L, R]$ que maximice la tasa de rendimiento:

Reorganizando la tasa de rendimiento compuesto y tomando logaritmos en ambos lados (manteniendo la monotonicidad), obtenemos:

$$\ln (1 + C(X, k)) = \sum_{i \in X} P_i \ln (1 + k \cdot R_i)$$

Sea

$$G(k) = \ln(1 + C(X, k)) = \sum_{i \in X} P_i \ln (1 + k R_i)$$

Según la definición de apalancamiento óptimo:

$$k_o = \argmax_k C(X, k)$$

Dado que $f(x) = \ln(1+x)$ es monótonamente creciente:

$$k_o = \argmax_k C(X, k) = \argmax_k G(k)$$

Calculando la primera y segunda derivada de $G(k)$:

$$G'(k) = \sum_{i \in X} \frac{P_i R_i}{1 + k R_i} $$

$$G''(k) = \sum\_{i \in X} -\frac{P_i R_i^2}{(1 + k R_i)^2} $$

La segunda derivada es no positiva en cada término, por lo que $G''(k) \le 0$. Solo cuando $P_i R_i \equiv 0$, $G''(k) = 0$, y en ese caso, $G(k) \equiv 0$, no hay rendimiento, carece de significado práctico. En otros casos, $G''(k) < 0$. Esto significa que $G(k)$ es una función estrictamente cóncava, $G'(k)$ es estrictamente monótona decreciente. $G(k)$ tiene un único punto máximo, y este punto máximo es también el punto de valor máximo.

Como se muestra en la siguiente figura, independientemente del número de términos, la curva de $G(k)$ es cóncava.

![Ilustración de la curva de la Fórmula de Kelly](image-1.png)

El punto máximo de $G(k)$ es el cero de su primera derivada:

$$G'(k) = \sum_{i \in X} \frac{P_i R_i}{1 + k R_i} = 0$$

Si reorganizamos esta ecuación, se puede transformar en una ecuación polinómica en k.
Si existen $N$ valores diferentes para $R_i$, el grado máximo del polinomio anterior es $N-1$.
Según el teorema de Abel-Ruffini, los polinomios de grado cinco o superior no tienen una fórmula general para encontrar raíces.

La fórmula de Kelly común es un caso especial con $N=2$: sea la probabilidad de ganar $p$, el odds $b$.

| Resultado | Probabilidad | Tasa de Rendimiento |
| --------- | ------------ | ------------------- |
| Ganar     | $p$          | $b$                 |
| Perder    | $1-p$        | $-1$                |

Sustituyendo obtenemos la ecuación:

$$G'(k) = \frac{pb}{1+kb} + \frac{-(1-p)}{1 -k} = 0$$

Reorganizando se obtiene

$$k = \frac{p(b+1)-1}{b}$$

Que es la fórmula de Kelly.

Para escenarios de trading, pueden aparecer infinitos resultados con diferentes tasas de rendimiento, por lo que solo se pueden buscar soluciones numéricas.

Como función estrictamente cóncava de una variable, el método de Newton es la elección ideal para resolverlo.
Comenzar la iteración desde el punto fijo $$G(0) = 0$$ es una buena opción; una función estrictamente cóncava convergerá al mismo resultado desde cualquier punto de inicio.

#### Situación donde el método de Newton excede el dominio factible

Un problema potencial es que el punto de iteración obtenido por el método de Newton puede estar fuera del dominio factible del problema.
Usemos un ejemplo mínimo para ilustrar esta situación:

$$p_1 = 0.9, r_1 = 0.5, p_2 = 0.1, r_2 = -1$$

Obtenemos

$$G(k) = 0.9 \times \ln(1+0.5k) + 0.1 \times \ln(1 - k)$$

![Imagen de la función G(k)](image-2.png)

El cálculo muestra que el dominio factible es $K = (-2, 1)$, el apalancamiento óptimo analítico es $k_o = 0.7$,
pero al usar el método de Newton, el primer punto de iteración

$$G(0) - \frac{G'(0)}{G''(0)} = \frac{14}{13} > 1$$

![Demostración de G'(k) y el método de Newton](image-3.png)

El primer punto de iteración ya excede el dominio factible, está fuera del dominio de definición de la derivada, y continuar iterando carece de sentido. Esto muestra que el método de Newton ingenuo por sí solo no puede manejar situaciones donde se excede el dominio factible.

La solución es, después de calcular el punto de iteración con el método de Newton, verificar adicionalmente si está dentro del dominio factible. Si lo está, se itera hasta allí; si no, según su dirección, se toma un punto entre el límite del dominio factible y el punto actual como el siguiente punto de iteración.

#### Pseudocódigo del algoritmo

Algoritmo $\text{resolve}(G, L, R, \epsilon = 10^{-9}, N = 100, \alpha = 0.9)$

1.  Inicializar $k \gets 0$
2.  Según las tasas de rendimiento $r_i$, calcular el dominio factible básico $K$
3.  Recortar el dominio factible $L \gets \max(L, \min K), R \gets \min(R, \max K)$
4.  Bucle máximo $N$ veces:
    1.  Calcular el siguiente punto $k' \gets k - \frac{G'(k)}{G''(k)}$
    2.  Si $k'$ no pertenece a $K$
        1.  Si $k' \ge R$, tomar $k' \gets \alpha R + (1-\alpha)k$
        2.  Si $k' \le L$, tomar $k' \gets \alpha L + (1 - \alpha) k$
    3.  Si la diferencia es menor que el umbral de precisión $| k' - k | < \epsilon$, salir del bucle.
    4.  Actualizar $k \gets k'$
5.  Devolver $k$

#### Implementación del código

Desde una perspectiva de programación, una abstracción más adecuada es: supongamos que cada resultado en el conjunto de resultados tiene dos atributos, tasa de rendimiento r y peso w. Este espacio de resultados puede ser recorrido, entonces el algoritmo se puede escribir como:

```ts
/**
 * Según el criterio de Kelly, calcula el apalancamiento óptimo k y el rendimiento esperado e.
 *
 * @param R - Vector de tasas de rendimiento
 * @param W - Vector de pesos
 * @param lower - Límite mínimo de apalancamiento
 * @param upper - Límite máximo de apalancamiento
 * @param eps - Precisión de convergencia
 * @param max_iter - Número máximo de iteraciones
 * @param alpha - Factor de aceleración de convergencia
 * @returns Un